"""
Local Flask Test Server for Testing Flutter App
Run this to test login without touching production
"""

from flask import Flask, request, jsonify
from flask_cors import CORS

app = Flask(__name__)
CORS(app)  # Enable CORS for Flutter to connect

# Fake user database for testing
TEST_USERS = {
    'testuser': 'password123',
    'admin': 'admin123',
    'demo': 'demo'
}

@app.route('/login', methods=['POST'])
def login():
    """
    Test login endpoint that mimics your real server
    """
    # Get JSON data from request
    data = request.get_json()
    
    if not data:
        return jsonify({
            'success': False,
            'message': 'No data provided'
        }), 400
    
    username = data.get('username', '').strip()
    password = data.get('password', '')
    
    # Validate input
    if not username or not password:
        return jsonify({
            'success': False,
            'message': 'Username and password are required'
        }), 400
    
    # Check credentials against test database
    if username in TEST_USERS and TEST_USERS[username] == password:
        return jsonify({
            'success': True,
            'message': 'Login successful',
            'user_id': 1,
            'username': username
        }), 200
    else:
        return jsonify({
            'success': False,
            'message': 'Invalid username or password'
        }), 401

@app.route('/test', methods=['GET'])
def test():
    """
    Simple test endpoint to verify server is running
    """
    return jsonify({
        'status': 'Server is running!',
        'test_users': list(TEST_USERS.keys())
    })

if __name__ == '__main__':
    print("\n" + "="*50)
    print("Flask Test Server Starting...")
    print("="*50)
    print("\nTest Users:")
    for user, pwd in TEST_USERS.items():
        print(f"  Username: {user}, Password: {pwd}")
    print("\nEndpoints:")
    print("  - http://localhost:5001/test (GET)")
    print("  - http://localhost:5001/login (POST)")
    print("\nPress Ctrl+C to stop")
    print("="*50 + "\n")
    
    # Run on all interfaces so your phone/emulator can connect
    app.run(debug=True, host='0.0.0.0', port=5001)
